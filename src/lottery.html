<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® OMO Select Â∞àÂ±¨ÊäΩÁçé ‚ú®</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Premium Palette */
            --bg-gradient-start: #fdfbfb;
            --bg-gradient-end: #ebedee;
            --primary: #d4a373;
            /* Muted Gold */
            --accent: #bc6c25;
            /* Bronze */
            --text-dark: #2f3e46;
            --text-light: #52796f;
            --white-glass: rgba(255, 255, 255, 0.9);
            --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
            --border-glass: 1px solid rgba(255, 255, 255, 0.8);
            --gold-gradient: linear-gradient(135deg, #e3d5b0 0%, #d4a373 50%, #bc6c25 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #FFF0F5 0%, #FFF5EE 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Ë≥™ÊÑüËÉåÊôØË£ùÈ£æ */
        .bg-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.5;
            animation: orbFloat 25s infinite alternate;
        }

        .orb-1 {
            top: -10%;
            left: -10%;
            width: 60vw;
            height: 60vw;
            background: radial-gradient(#e3d5b0, transparent);
        }

        .orb-2 {
            bottom: -10%;
            right: -10%;
            width: 60vw;
            height: 60vw;
            background: radial-gradient(#fae1dd, transparent);
        }

        @keyframes orbFloat {
            0% {
                transform: translate(0, 0) scale(1);
            }

            100% {
                transform: translate(30px, 30px) scale(1.05);
            }
        }

        /* ÂØÜÁ¢º‰øùË≠∑ÈÅÆÁΩ© */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .password-box {
            background: rgba(255, 255, 255, 0.9);
            padding: 60px 80px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.05);
            text-align: center;
            border: var(--border-glass);
        }

        .password-box h2 {
            font-family: 'Playfair Display', serif;
            color: var(--text-dark);
            margin-bottom: 30px;
            font-size: 32px;
            letter-spacing: 2px;
        }

        .password-box input {
            padding: 15px;
            font-size: 16px;
            border: none;
            border-bottom: 2px solid #ddd;
            width: 100%;
            text-align: center;
            background: transparent;
            outline: none;
            transition: all 0.3s;
            font-family: 'Noto Sans TC', sans-serif;
            letter-spacing: 4px;
        }

        .password-box input:focus {
            border-bottom-color: var(--primary);
        }

        .password-box button {
            margin-top: 40px;
            padding: 12px 40px;
            background: var(--text-dark);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        /* ‰∏ªÈ†ÅÈù¢ */
        .main-container {
            display: none;
            width: 100%;
            max-width: 1200px;
            padding: 40px;
            height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 56px;
            color: var(--text-dark);
            margin-bottom: 10px;
            letter-spacing: 3px;
            font-weight: 700;
        }

        .header p {
            color: #888;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* ÂÖßÂÆπ‰ΩàÂ±ÄÔºöÂ∑¶Âè≥ÁµêÊßã */
        .content-grid {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 60px;
            align-items: center;
            /* ÂûÇÁõ¥ÁΩÆ‰∏≠ */
            height: calc(100vh - 250px);
        }

        /* Â∑¶ÂÅ¥ÔºöÁçéÈ†ÖÂàóË°® */
        .glass-panel {
            background: var(--white-glass);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 35px;
            box-shadow: var(--shadow-glass);
            border: var(--border-glass);
            height: auto;
            max-height: 100%;
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            color: var(--text-dark);
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prize-item {
            display: flex;
            align-items: center;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 16px;
            background: white;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
            /* È†êË®≠ÁÑ°ÈÇäÊ°Ü */
        }

        .prize-item.active {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            /* Âä†Ê∑±Èô∞ÂΩ± */
            transform: scale(1.02);
            border: 1px solid rgba(212, 163, 115, 0.3);
            /* Ê∑°ÈáëËâ≤ÈÇäÊ°Ü */
        }

        .prize-item.completed {
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.5);
            border-color: transparent;
        }

        .prize-icon {
            font-size: 28px;
            margin-right: 20px;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f8f9fa;
            border-radius: 50%;
            transition: all 0.3s;
            overflow: hidden;
            /* Á¢∫‰øùÂúñÁâá‰∏çÊ∫¢Âá∫ */
        }

        .prize-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .prize-item.active .prize-icon {
            background: #fff5ec;
            color: var(--accent);
        }

        .prize-details {
            flex: 1;
        }

        .prize-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .prize-status {
            font-size: 13px;
            color: #999;
        }

        .prize-item.active .prize-status {
            color: var(--accent);
            font-weight: 500;
        }

        /* Áç≤ÁçéËÄÖÊ®ôË®ò */
        .winner-badge {
            margin-left: auto;
            background: var(--text-dark);
            color: white;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            opacity: 0;
            transform: translateX(10px);
            transition: all 0.3s;
        }

        .prize-item.completed .winner-badge {
            opacity: 1;
            transform: translateX(0);
        }

        /* Âè≥ÂÅ¥ÔºöÊäΩÁçéÂçÄ */
        .lottery-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .stats-minimal {
            position: absolute;
            top: -50px;
            background: white;
            padding: 10px 30px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            font-size: 14px;
            color: #666;
            letter-spacing: 1px;
            font-family: 'Playfair Display', serif;
        }

        /* ÂçáÁ¥öÁâà 3D Á±§Á≠í */
        .lottery-tube-container {
            width: 300px;
            /* Âä†Â§ß */
            height: 480px;
            /* Âä†È´ò */
            position: relative;
            margin-bottom: 60px;
            perspective: 1200px;
        }

        .tube-body {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 320px;
            border-radius: 0 0 60px 60px;
            /* Ê∏ÖÊô∞ÈÄè‰∫ÆÊùêË≥™ */
            background: linear-gradient(105deg,
                    rgba(255, 255, 255, 0.1) 0%,
                    rgba(255, 255, 255, 0.02) 30%,
                    rgba(255, 255, 255, 0.0) 50%,
                    rgba(255, 255, 255, 0.02) 70%,
                    rgba(255, 255, 255, 0.1) 100%);
            box-shadow:
                inset 0 0 20px rgba(255, 255, 255, 0.3),
                inset 2px 0 5px rgba(255, 255, 255, 0.2),
                inset -2px 0 5px rgba(255, 255, 255, 0.2),
                0 30px 60px rgba(0, 0, 0, 0.1);
            /* ÁßªÈô§Ê®°Á≥äÔºå‰øùÊåÅÊ∏ÖÊô∞ */
            /* backdrop-filter: blur(4px); */
            z-index: 10;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-top: none;
        }

        /* Á±§Á≠íÂ∫ïÈÉ®Ë£ùÈ£æÁí∞ - ÈáëÂ±¨Ë≥™ÊÑü */
        .tube-base {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            /* Ëàá body ÂêåÂØ¨ */
            height: 40px;
            border-radius: 0 0 60px 60px;
            background: linear-gradient(90deg, #d4a373, #e3d5b0, #d4a373);
            z-index: 9;
            opacity: 0.3;
        }

        .tube-rim {
            position: absolute;
            bottom: 290px;
            /* Â∞çÈΩä body È†ÇÈÉ® */
            left: 50%;
            transform: translateX(-50%);
            width: 210px;
            /* Áï•ÂØ¨Êñº body */
            height: 60px;
            /* Ê©¢ÂúìÈ´òÂ∫¶ */
            border-radius: 50%;
            /* ÈáëÂ±¨Ë≥™ÊÑüÁí∞ */
            background: linear-gradient(135deg, #e0e0e0 0%, #ffffff 50%, #c0c0c0 100%);
            z-index: 11;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        /* Á±§Ê°∂ÂÖßÈÉ®Èô∞ÂΩ±ÔºåÂ¢ûÂä†Ê∑±Â∫¶ */
        .tube-inner-shadow {
            position: absolute;
            bottom: 300px;
            left: 50%;
            transform: translateX(-50%);
            width: 190px;
            height: 30px;
            border-radius: 50%;
            background: radial-gradient(rgba(0, 0, 0, 0.1), transparent 70%);
            z-index: 4;
        }

        .sticks-group {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 250px;
            z-index: 5;
            transition: transform 0.2s;
        }

        .stick {
            position: absolute;
            bottom: 0;
            width: 14px;
            height: 220px;
            /* Ë≥™ÊÑüÊú®Á¥ãÊàñÈáëÂ±¨Á±§ */
            background: linear-gradient(to right, #cd7f32, #f4c2c2, #cd7f32);
            border-radius: 6px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.15);
        }

        #stick1 {
            left: 45px;
            transform: rotate(-6deg);
            height: 200px;
            background: linear-gradient(to right, #b08d55, #d4a373, #b08d55);
        }

        #stick2 {
            left: 65px;
            transform: rotate(3deg);
            height: 215px;
            background: linear-gradient(to right, #b08d55, #e3d5b0, #b08d55);
        }

        #stick3 {
            left: 80px;
            transform: rotate(-4deg);
            height: 190px;
            background: linear-gradient(to right, #b08d55, #d4a373, #b08d55);
        }

        #stick4 {
            left: 30px;
            transform: rotate(-12deg);
            height: 185px;
            background: linear-gradient(to right, #b08d55, #e3d5b0, #b08d55);
        }

        #stick5 {
            left: 95px;
            transform: rotate(10deg);
            height: 195px;
            background: linear-gradient(to right, #b08d55, #d4a373, #b08d55);
        }

        /* ÊêñÊôÉÂãïÁï´ÂÑ™Âåñ */
        @keyframes intense-shake {
            0% {
                transform: translateX(-50%) translateY(0) rotate(0);
            }

            10% {
                transform: translateX(-52%) translateY(-10px) rotate(-8deg);
            }

            30% {
                transform: translateX(-48%) translateY(10px) rotate(8deg);
            }

            50% {
                transform: translateX(-54%) translateY(-8px) rotate(-6deg);
            }

            70% {
                transform: translateX(-46%) translateY(8px) rotate(6deg);
            }

            90% {
                transform: translateX(-51%) translateY(-2px) rotate(-2deg);
            }

            100% {
                transform: translateX(-50%) translateY(0) rotate(0);
            }
        }

        @keyframes stick-bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-15px);
            }
        }

        @keyframes individual-shake {
            0% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-20px) rotate(5deg);
            }

            50% {
                transform: translateY(0) rotate(-5deg);
            }

            75% {
                transform: translateY(-10px) rotate(3deg);
            }

            100% {
                transform: translateY(0) rotate(0deg);
            }
        }

        .shaking-hard {
            animation: intense-shake 0.6s infinite;
        }

        .stick.shaking-individual {
            /* ÊáâÁî®Áç®Á´ãÂãïÁï´Ôºåduration Èö®Ê©üÂåñÂú® JS ÊéßÂà∂ */
            animation: individual-shake 0.4s infinite ease-in-out alternate;
        }

        /* È£õÂá∫ÁöÑÁ±§ */
        .flying-stick {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50px;
            height: 300px;
            background: linear-gradient(135deg, #fff 0%, #fdfbfb 100%);
            border: 2px solid var(--primary);
            border-radius: 12px;
            z-index: 100;
            display: none;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        /* Á±§È†≠Ë£ùÈ£æ */
        .flying-stick::before {
            content: '';
            position: absolute;
            top: 20px;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .flying-stick.active {
            display: flex;
            animation: flyOutPremium 2s cubic-bezier(0.19, 1, 0.22, 1) forwards;
        }

        @keyframes flyOutPremium {
            0% {
                transform: translate(-50%, 100%) scale(0.4) rotateX(60deg);
                opacity: 0;
            }

            30% {
                transform: translate(-50%, -40%) scale(1.1) rotateX(10deg);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -60%) scale(1) rotateY(360deg);
            }
        }

        .stick-text-v {
            writing-mode: vertical-rl;
            text-orientation: upright;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
            letter-spacing: 8px;
            margin-top: 30px;
            font-family: 'Noto Sans TC', sans-serif;
        }

        /* START ÊåâÈàï */
        .draw-btn {
            padding: 20px 70px;
            font-size: 20px;
            font-weight: 500;
            letter-spacing: 4px;
            /* Âä†Â§ßÈñìË∑ù */
            background: var(--text-dark);
            color: white;
            border: none;
            border-radius: 60px;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            box-shadow: 0 15px 40px rgba(47, 62, 70, 0.2);
            position: relative;
            overflow: hidden;
            font-family: 'Playfair Display', serif;
        }

        /* ÂÖâÊæ§ÊïàÊûú */
        .draw-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 60%);
            transform: scale(0);
            transition: transform 0.6s;
            opacity: 0;
        }

        .draw-btn:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(47, 62, 70, 0.3);
            background: #1a252a;
        }

        .draw-btn:hover::before {
            transform: scale(1);
            opacity: 1;
        }

        .draw-btn:disabled {
            background: #ccc;
            transform: none;
            cursor: not-allowed;
            box-shadow: none;
            color: #888;
        }

        /* ÊéßÂà∂ÂçÄ (Èö±ËóèÂºè) */
        .admin-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .admin-controls:hover {
            opacity: 1;
        }

        .icon-btn {
            background: white;
            border: 1px solid #ddd;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            color: #666;
            margin-left: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* ÂΩàÁ™óÂÑ™Âåñ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(47, 62, 70, 0.2);
            backdrop-filter: blur(25px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 70px 60px;
            border-radius: 40px;
            text-align: center;
            box-shadow: 0 30px 90px rgba(0, 0, 0, 0.15);
            max-width: 550px;
            width: 90%;
            animation: bloom 0.7s cubic-bezier(0.19, 1, 0.22, 1);
            border: 1px solid rgba(255, 255, 255, 0.8);
            position: relative;
        }

        /* Ë£ùÈ£æÁ∑öÊ¢ù */
        .modal-content::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 30px;
            pointer-events: none;
        }

        @keyframes bloom {
            0% {
                transform: scale(0.9) translateY(20px);
                opacity: 0;
            }

            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            font-size: 26px;
            margin-bottom: 35px;
            font-style: italic;
            letter-spacing: 1px;
        }

        .modal-winner {
            font-size: 56px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 25px;
            font-family: 'Noto Sans TC', sans-serif;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .modal-prize {
            display: inline-block;
            background: #f8f9fa;
            padding: 12px 35px;
            border-radius: 50px;
            color: #555;
            margin-bottom: 50px;
            font-size: 18px;
            letter-spacing: 1px;
            border: 1px solid #eee;
        }

        .modal-btn {
            padding: 18px 60px;
            background: var(--text-dark);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 2px;
            box-shadow: 0 10px 30px rgba(47, 62, 70, 0.15);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(47, 62, 70, 0.25);
        }
    </style>
</head>

<body>
    <!-- ËÉåÊôØÂÖâÊöà -->
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>

    <!-- ÂØÜÁ¢º -->
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-box">
            <h2>Authentication</h2>
            <input type="password" id="passwordInput" placeholder="ENTER ACCESS CODE"
                onkeypress="if(event.key==='Enter')verifyPassword()">
            <button onclick="verifyPassword()">UNLOCK</button>
            <div id="errorMsg" style="color:#d4a373; margin-top:15px; height:20px; font-size:12px;"></div>
        </div>
    </div>

    <!-- ‰∏ª‰ªãÈù¢ -->
    <div class="main-container" id="mainContainer">
        <div class="header">
            <h1>OMO Select</h1>
            <p>Exclusive Giveaway Event</p>
        </div>

        <div class="content-grid">
            <!-- Â∑¶ÂÅ¥ÔºöÁçéÈ†ÖÂàóË°® -->
            <div class="glass-panel">
                <div class="panel-title">
                    <span>Prize List</span>
                </div>
                <div class="prize-list-container" id="prizeList">
                    <!-- JS ÁîüÊàê -->
                </div>
            </div>

            <!-- Âè≥ÂÅ¥ÔºöÊäΩÁçéÂçÄ -->
            <div class="lottery-center">
                <div class="lottery-tube-container">
                    <div class="tube-rim"></div>
                    <div class="tube-inner-shadow"></div>
                    <div class="tube-body" id="tubeBody"></div>
                    <div class="tube-base"></div>
                    <div class="sticks-group" id="sticksGroup">
                        <div class="stick" id="stick1"></div>
                        <div class="stick" id="stick2"></div>
                        <div class="stick" id="stick3"></div>
                        <div class="stick" id="stick4"></div>
                        <div class="stick" id="stick5"></div>
                    </div>
                </div>

                <div class="flying-stick" id="flyingStick">
                    <div class="stick-text-v" id="stickText"></div>
                </div>

                <button class="draw-btn" id="drawBtn" onclick="startDraw()">START DRAW</button>
            </div>
        </div>

        <!-- Èö±ËóèÂºèÊéßÂà∂ -->
        <div class="admin-controls">
            <button class="icon-btn" onclick="exportResults()" title="Export CSV">‚Üì</button>
            <button class="icon-btn" onclick="reloadData()" title="Reset">‚Üª</button>
        </div>
    </div>

    <!-- ÂΩàÁ™ó -->
    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <div class="modal-title">Authorized Personnel Only</div>
            <div class="modal-prize" id="modalPrize"></div>
            <div class="modal-winner" id="modalWinner"></div>
            <button class="modal-btn" onclick="closeWinnerModal()">CONFIRM</button>
        </div>
    </div>

    <!-- Èü≥Êïà -->
    <audio id="shakeSound">
        <source src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound">
        <source src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3" type="audio/mpeg">
    </audio>

    <!-- ÊííËä± (Canvas) -->
    <canvas id="confettiCanvas"
        style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1500;"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        // ÈÖçÁΩÆ
        const CONFIG = {
            PASSWORD: 'omo2025',
            GAS_API_URL: 'https://script.google.com/macros/s/AKfycby7V5VwHfn_Tb-wpg_SSrme2c2P5bin6qjhxEkr80RDLg6p5TPn2EXySkpG9qnyvfNF/exec',
            PRIZES: [
                { id: 4, name: '7-11 ÂÖçÈÅãÂà∏', sub: 'Shipping Voucher', icon: 'üé´' },
                { id: 3, name: 'fwee ÂîáÈ†∞ÂÖ©Áî®', sub: 'Lip & Cheek', icon: 'https://fwee.com.tw/cdn/shop/files/01.jpg?v=1758508353&width=500' },
                { id: 2, name: 'ÁÜäË≤ì‰øÆË≠∑ÂÜçÁîüÈúú', sub: 'PDRN Cream', icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSytwB4V8AXTkzYMq0rylZUJDz6qa7bxgXzGw&s' },
                { id: 1, name: 'MAC Âè£Á¥Ö', sub: 'Random Shade', icon: 'https://img.ssgdfs.com/upload/C00001/goos/org/229/251216001003229.jpg?RS=440' }
            ],
            START_DATE: new Date('2026-01-01'),
            END_DATE: new Date('2026-01-20'),
            MIN_AMOUNT: 1000
        };

        // ÁãÄÊÖã
        let state = {
            pool: [],
            winners: [],
            currentPrizeIdx: 0,
            isDrawing: false,
            orders: []
        };

        const EL = {
            passOverlay: document.getElementById('passwordOverlay'),
            mainContainer: document.getElementById('mainContainer'),
            drawBtn: document.getElementById('drawBtn'),
            sticks: document.getElementById('sticksGroup'),
            flyingStick: document.getElementById('flyingStick')
        };

        function init() {
            renderPrizes();
        }

        // ÂØÜÁ¢ºÈ©óË≠â
        function verifyPassword() {
            const val = document.getElementById('passwordInput').value;
            if (val === CONFIG.PASSWORD) {
                EL.passOverlay.style.opacity = '0';
                setTimeout(() => {
                    EL.passOverlay.style.display = 'none';
                    EL.mainContainer.style.display = 'block';
                    loadData();
                }, 500);
            } else {
                document.getElementById('errorMsg').textContent = 'INCORRECT PASSWORD';
            }
        }

        // Ë≥áÊñôËºâÂÖ•
        async function loadData() {
            EL.drawBtn.textContent = 'CONNECTING...';
            EL.drawBtn.disabled = true;

            try {
                const res = await fetch(CONFIG.GAS_API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'adminAction',
                        subAction: 'getDashboardData',
                        password: CONFIG.PASSWORD
                    })
                });
                const json = await res.json();
                if (json.success) {
                    processData(json.data.orders);
                    EL.drawBtn.textContent = 'START DRAW';
                    EL.drawBtn.disabled = false;
                } else {
                    alert('Error loading data');
                }
            } catch (e) {
                console.error(e);
                alert('Connection failed');
            }
        }

        function processData(orders) {
            state.orders = orders;
            state.pool = [];
            const participants = new Set(); // Store unique phone numbers for count

            orders.forEach(o => {
                const d = parseDate(o.date);
                if (!d || d < CONFIG.START_DATE || d > CONFIG.END_DATE) return;
                if (o.status && (o.status.includes('ÂèñÊ∂à'))) return;

                const amt = (parseFloat(o.total) || 0) - (parseFloat(o.shippingFee) || 0);
                const chances = Math.floor(amt / CONFIG.MIN_AMOUNT);

                if (chances > 0) {
                    const name = o.customerName || 'Guest';
                    const phone = o.customerPhone || '';
                    if (phone) participants.add(phone);

                    for (let i = 0; i < chances; i++) {
                        state.pool.push({ name, phone, amt });
                    }
                }
            });

        }

        function parseDate(str) {
            if (!str) return null;
            const d = new Date(str);
            return isNaN(d) ? null : d;
        }

        function renderPrizes() {
            const container = document.getElementById('prizeList');
            container.innerHTML = CONFIG.PRIZES.map((p, idx) => `
                <div class="prize-item ${idx === 0 ? 'active' : ''}" id="prize-item-${idx}">
                    <div class="prize-icon">${p.icon.startsWith('http') ? `<img src="${p.icon}">` : p.icon}</div>
                    <div class="prize-details">
                        <div class="prize-name">${p.name}</div>
                        <div class="prize-status" id="prize-status-${idx}">${p.sub}</div>
                    </div>
                    <div class="winner-badge" id="winner-badge-${idx}"></div>
                </div>
            `).join('');
        }

        async function startDraw() {
            if (state.isDrawing) return;
            if (state.currentPrizeIdx >= CONFIG.PRIZES.length) return;
            if (state.pool.length === 0) { alert('Pool is empty'); return; }

            state.isDrawing = true;
            EL.drawBtn.disabled = true;
            EL.drawBtn.textContent = 'DRAWING...';

            playSound('shake');
            EL.sticks.classList.add('shaking-hard');

            // Áç®Á´ãÊôÉÂãïÁ±§Ê¢ù
            const sticks = document.querySelectorAll('.stick');
            sticks.forEach(s => {
                s.style.animationDelay = `${Math.random() * 0.5}s`;
                s.style.animationDuration = `${0.3 + Math.random() * 0.3}s`;
                s.classList.add('shaking-individual');
            });

            await wait(2500); // Á®çÂæÆÂä†Èï∑ÊêñÊôÉÊôÇÈñì

            EL.sticks.classList.remove('shaking-hard');
            sticks.forEach(s => {
                s.classList.remove('shaking-individual');
                s.style.animationDelay = '0s';
            });

            const winIdx = Math.floor(Math.random() * state.pool.length);
            const winner = state.pool[winIdx];
            state.pool.splice(winIdx, 1);

            const prize = CONFIG.PRIZES[state.currentPrizeIdx];
            document.getElementById('stickText').textContent = maskName(winner.name);
            EL.flyingStick.classList.add('active');

            await wait(2000); // Á≠âÂæÖÈ£õÂá∫ÂãïÁï´ÂÆåÊï¥

            renderModal(winner, prize);
            playSound('win');
            confetti({
                particleCount: 200,
                spread: 100,
                origin: { y: 0.6 },
                gravity: 0.8,
                colors: ['#d4a373', '#bc6c25', '#e3d5b0', '#ffffff']
            });

            state.winners.push({ ...winner, prize: prize.name });
            updatePrizeUI(winner.name, state.currentPrizeIdx);

            state.currentPrizeIdx++;
            if (state.currentPrizeIdx >= CONFIG.PRIZES.length) {
                EL.drawBtn.textContent = 'EVENT COMPLETED';
            } else {
                EL.drawBtn.textContent = 'NEXT DRAW';
                EL.drawBtn.disabled = false;
            }

            state.isDrawing = false;
        }

        function updatePrizeUI(winnerName, idx) {
            const currentItem = document.getElementById(`prize-item-${idx}`);
            if (currentItem) {
                currentItem.classList.remove('active');
                currentItem.classList.add('completed');

                // Update badge instead of text
                const badge = document.getElementById(`winner-badge-${idx}`);
                badge.textContent = maskName(winnerName);

                // Update status text
                document.getElementById(`prize-status-${idx}`).textContent = 'Winner Announced';
            }

            const nextItem = document.getElementById(`prize-item-${idx + 1}`);
            if (nextItem) {
                nextItem.classList.add('active');
            }
        }

        function renderModal(winner, prize) {
            document.getElementById('modalWinner').textContent = maskName(winner.name);
            document.getElementById('modalPrize').textContent = prize.name;
            document.getElementById('winnerModal').classList.add('active');
        }

        function closeWinnerModal() {
            document.getElementById('winnerModal').classList.remove('active');
            EL.flyingStick.classList.remove('active');
        }

        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }
        function playSound(id) {
            const audio = document.getElementById(id + 'Sound');
            if (audio) { audio.currentTime = 0; audio.play().catch(() => { }); }
        }

        function reloadData() {
            if (confirm('Reload and reset?')) location.reload();
        }

        function exportResults() {
            let csv = 'Prize,Winner,Phone,Amount\n';
            state.winners.forEach(w => {
                csv += `${w.prize},${w.name},${w.phone},${w.amt}\n`;
            });
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `OMO_Select_Giveaway_${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
        }

        function maskName(name) {
            if (!name || name.length < 2) return name;
            if (name.length === 2) return name[0] + '*';
            return name[0] + '*' + name.slice(2);
        }

        init();
    </script>
</body>

</html>